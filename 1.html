<html>
<head>
	<title>#1 サイトマップ</title>
  <meta content="JavaScriptのfetchを利用してhtmlファイルから自動的にtitleやcontent情報を抜き出して表示する全自動サイトマップ(今開いているページ)です">
  <style>
    table {
      border-collapse: collapse;
      text-align: center;
    }
    th,td {
      padding: 5px;
      border: 1px solid #999;
    }
  </style>
</head>
<body>
<div id="box"></div>
<script>
n=500
var table = document.createElement('table');

var tr = document.createElement('tr');
  var th1 = document.createElement('th');
  var th2 = document.createElement('th');
  var th3 = document.createElement('th');
  th1.textContent = "ファイル名";
  th2.textContent = "リンク";
  th3.textContent = "説明";
  tr.appendChild(th1);
  tr.appendChild(th2);
  tr.appendChild(th3);
table.appendChild(tr);

for (var i = 1; i < n+1; i++) {
  var tr = document.createElement('tr');

    var td1 = document.createElement('td');
    td1.textContent = i + '.html';
    tr.appendChild(td1);

    var td2 = document.createElement('td');
      var a = document.createElement("a");
      a.href=i+".html";
      a.id=i;
      td2.appendChild(a);
    tr.appendChild(td2);

    var td3 = document.createElement('td');
    td3.id="a"+i;

    tr.appendChild(td3);


  table.appendChild(tr);
  }

document.getElementById('box').appendChild(table);




function url(url,id,id2){
  var box = document.getElementById(id);
  var box2 = document.getElementById(id2);
  fetch(url)
    .then(response => {
      return response.text();
    })
    .then(body => {
      var title = body.match(/<title>(.*)<\/title>/);
      var content = body.match(/content=\"(.*)\"/);

      if(!title){
        box.innerHTML=url
        }
        else{
         box.innerHTML=title[1];
        };

      if(!content){
        box2.innerHTML=""
        }
        else{
         box2.innerHTML=content[1];
        };
        })

    .catch((reason) => {
      box.innerHTML="-"
      box2.innerHTML=""
    })

  };

for (let step = 0; step < n+1; step++) {
  url(step+".html",step,"a" + step)
};

</script>

</body>
</html>
