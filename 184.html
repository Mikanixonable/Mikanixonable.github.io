<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Custom Range Slider</title>
    <style media="screen">

    /* フォント */
    @import url("https://fonts.googleapis.com/css?family=Lato&display=swap");

    * {
      /* padding/borderをwidth/heightに含める */
      box-sizing: border-box;
    }

    body {
      background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      font-family: "Lato", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      margin: 0;
    }
    h2 {
      position: absolute;
      top: 10px;
    }
    .range-container {
      position: relative;
    }

    input[type="range"] {
  width: 300px;
  margin: 18px 0;
  /* WebKit ベースのブラウザー (Safari など) と
   Blink ベースのブラウザー (Chrome, Opera など) で
   同じことを実現するために使用される。
   なお、 Firefox や Edge もまた、互換性の理由から
   -webkit-appearance に対応している。 */
  -webkit-appearance: none;
}

input[type="range"]:focus {
  /* 青線を消す */
  outline: none;
}

input[type="range"] + label {
  background-color: #fff;
  position: absolute;
  top: -25px;
  left: 110px;
  width: 80px;
  padding: 5px 0;
  text-align: center;
  border-radius: 4px;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}
/* Chrome & Safari */
input[type="range"]::-webkit-slider-runnable-track {
  background-color: purple;
  border-radius: 4px;
  width: 100%;
  height: 10px;
  cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  height: 24px;
  width: 24px;
  background: #fff;
  border-radius: 50%;
  border: 1px solid purple;
  margin: -7px;
  cursor: pointer;
}





/* Firefox */
input[type='range']::-moz-range-track {
  background: purple;
  border-radius: 4px;
  width: 100%;
  height: 13px;
  cursor: pointer;
}

input[type='range']::-moz-range-thumb {
  -webkit-appearance: none;
  height: 24px;
  width: 24px;
  background: #fff;
  border-radius: 50%;
  border: 1px solid purple;
  margin-top: -7px;
  cursor: pointer;
}

/* IE */
input[type='range']::-ms-track {
  background: purple;
  border-radius: 4px;
  width: 100%;
  height: 13px;
  cursor: pointer;
}

input[type='range']::-ms-thumb {
  -webkit-appearance: none;
  height: 24px;
  width: 24px;
  background: #fff;
  border-radius: 50%;
  border: 1px solid purple;
  margin-top: -7px;
  cursor: pointer;
}



    </style>
  </head>
  <body>
    <h2>Custom Range Slider</h2>
    <div class="range-container">
      <input type="range" id="range" min="0" max="100">
      <label for="range">50</label>
    </div>

    <script src="script.js"></script>
  </body>
  <script type="text/javascript">
  // 要素の取得
const range = document.getElementById('range')

// レンジスライダーの状態変化時のイベント
range.addEventListener('input', (e) => {
  // レンジスライダーの値を取得
  // + は、string -> numberに変化させる
  const value = +e.target.value
  // label要素を取得
  const label = e.target.nextElementSibling

  // レンジスライダーに設定されているwidth(XXpx)を取得
  const range_width = getComputedStyle(e.target).getPropertyValue('width')
  // ラベルに設定されているwidth(XXpx)を取得
  const label_width = getComputedStyle(label).getPropertyValue('width')

  // pxをとる(300px -> 300)、かつ、+でnum化
  const num_width = +range_width.substring(0, range_width.length - 2)
  const num_label_width = +label_width.substring(0, label_width.length - 2)

  // レンジスライダーに設定している最大値、最小値
  const max = +e.target.max
  const min = +e.target.min

  // レンジスライダーのleftスタイルに設定する値の計算
  // レンジスライダーの値 * (レンジスライダーの幅 / レンジスライダーのmax値) - ラベルの幅 / 2 + スケール
  const left = value * (num_width / max) - num_label_width / 2 + scale(value, min, max, 10, -10)

  // スタイルへ適用
  label.style.left = `${left}px`


  // labelの更新
  label.innerHTML = value
})

// scaleの計算
// https://stackoverflow.com/questions/10756313/javascript-jquery-map-a-range-of-numbers-to-another-range-of-numbers
const scale = (num, in_min, in_max, out_min, out_max) => {
return (num - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
}
  </script>
</html>
