<html>

<head>
	<title>サイトマップ d3js</title>
	<meta content="">
</head>
<link rel="stylesheet" href="js/style.css">
<style>
	body {
		background-color: var(--c1);
		color: var(--c2);
		display: flex;
		/* justify-content: center; */
		flex-direction: column;
		align-items: center;
		padding: 0em;
		font-size: 1em;
		font-family: 'Franklin Gothic Medium', Arial, sans-serif;
	}

	h1 {
		font-size: 4em;
	}

	/* #chart {
		background-color: #ee5;
	} */

	.d3svg {
		background-color: #ffffff11;
	}
</style>

<body>
	<div id="i"></div>
	<h1>Site Map</h1>
	<div id="dev"></div>
	<div id="chart"></div>
</body>
<script src="js/d3.js"></script>
<script>
	const n = 200

	let dev = document.getElementById("dev")
	let i = document.getElementById("i")
	let str = window.location.href.split('/').pop();
	let num1 = parseInt(str.split(".")[0], 10) - 1 + ".html"
	let num2 = parseInt(str.split(".")[0], 10) + 1 + ".html"
	i.innerHTML = `<a href=\"${num1}\"><${num1}</a>` + " " 
	+ `<a href=\"index.html\">Top</a>`+ " "
	+ `<a href=\"${num2}\">${num2}></a>`

	let maxWidth = self.innerWidth
	let width = maxWidth * 0.9
	let height = self.innerHeight * 0.6

	const data = [...Array(n)].map((v, i) => i + 1)
	const datar = [...Array(n)].map(Math.random)
	// const datag = [...Array(n)].map((v, i) => genre((i) + ".html")) //genreList



	//準備
	function d3main() {
		const r = width / 10 / 2
		const svg = d3.select("#chart").append("svg")
			.attr("class", "d3svg")
			.attr("width", maxWidth)
			.attr("height", data.length / 10 * r * 2)
			.attr(`viewbox`, `0 0 ${maxWidth} ${height}`)
		const flame = svg.append("g")
			.attr("transform", `translate(${maxWidth / 2},${r})`)


		//描画
		const g = flame.selectAll("g").data(data).join("g")
			.attr("transform", (d, i) => `translate(${-width / 2 + r + 2 * r * (i % 10)},${Math.floor(i / 10) * 2 * r})`)//locale
			.append("a")
			.attr("href", (d, i) => d + ".html")

		const circle = g.append("circle")
			.attr("r", (d, i) => {
				let r2 = 0.5 * r + 0.5 * r * datar[i]
				return r2
			})
		// .attr("fill", "#789")

		const text = g.append("text")
			.text((d, i) => d)
			.attr("style", (d, i) => `font-size: ${0.5 * r + 0.5 * r * datar[i]}px`)
			.attr("text-anchor", "middle")
			.attr("alignment-baseline", "central")
			.attr("fill", "var(--c2)")

		//色塗り
		fetch("json/meta4.json")
			.then(response => { return response.json(); })
			.then(json => {
				let illustP = json.pages.filter((item, index) => {
					if (item.genre == "illust") {
						return true
					}
					return false
				});
				let fontP = json.pages.filter((item, index) => {
					if (item.genre == "font") {
						return true
					}
					return false
				});

				let illust = illustP.map((v, i) => v.filename)//illust
				let font = fontP.map((v, i) => v.filename)//illust
				// dev.innerHTML = vName[0]
				let exist = json.pages.map((v, i) => v.filename)//exist

				circle.attr("fill", (d, i) => {
					if (illust.indexOf(d + ".html") !== -1) {
						return "var(--c4)"
					}
					else if(font.indexOf(d + ".html") !== -1){
						return "var(--c6)"

					}
					else if (exist.indexOf(d + ".html") == -1) {
						return "#00000030"
					}
					return "var(--c5)"//normal color
				})
			});

	}
	d3main()

</script>


</html>